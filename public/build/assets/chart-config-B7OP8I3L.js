$(document).ready(function(){const m=new Date,I=m.getFullYear(),E=(m.getMonth()+1).toString().padStart(2,"0");document.getElementById("monthInput").value=`${I}-${E}`,document.getElementById("monthInputDoughnut").value=`${I}-${E}`;const F={id:"drawColumnDataNumber",afterDatasetsDraw:function(a,r,d){var u=a.ctx;a.data.datasets.forEach(function(o,e){var c=a.getDatasetMeta(e);c.hidden||c.data.forEach(function(g,l){if(!(o.data[l]<=0)){u.fillStyle="rgb(0,0,0)";var p=16,i="normal",s="Helvetica Neue";u.font=Chart.helpers.fontString(p,i,s);var t=D(o.data[l]).toString();u.textAlign="center",u.textBaseline="middle";var n=g.tooltipPosition();u.fillText(t,n.x,n.y)}})})}};var D=function(a){return(a/1).toFixed(0).replace(".",",").toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")};let _=document.getElementById("salesPurchasesChart"),k=document.getElementById("currentDailyChart"),B=document.getElementById("currentMonthChart"),y=new Chart(_,{type:"bar",options:{animation:{duration:500,easing:"easeOutQuart",onComplete:function({chart:a}){const r=a.ctx;r.textAlign="center",r.textBaseline="bottom",a.config.data.datasets.forEach(function(d,u){a.getDatasetMeta(u).data.forEach(function(e,c){const g=d.data[c];g>0&&r.fillText(D(g),e.x,e.y-5)})})}},scales:{x:{display:!0},y:{stacked:!0}},plugins:{tooltip:{callbacks:{label:function(a){var r=a.dataset.customData[a.dataIndex],d=a.dataset.data[a.dataIndex];return`Tổng: ${D(d)} | Tiền mặt: ${D(r.Cash)} | Chuyển khoản: ${D(r["Bank Transfer"])} | Tổng số ly : ${r.Count}`}}}}}}),b=new Chart(B,{type:"doughnut",plugins:[F]});$.get("/sales-purchases/chart-data",function(a){var r=[],d=new Date().getDate();new Date().getMonth();for(var u=1;u<=d;u++)r.push(u);var o=[],e=[],c=[],g=[],l=[];$.each(r,function(s,t){o[" "+t]=0,c[" "+t]={"Bank Transfer":0,Cash:0,Count:0}}),a.sales.original.statistics_data.forEach(function(s,t){if(s.statistic_day!==0){var n=new Date(s.statistic_day).getDate();c[" "+n]||(c[" "+n]={}),c[" "+n].Count=parseInt(s.count)}});var p=0;a.sales.original.data.forEach(function(s,t){var n=s.date;n=new Date(s.date).getDate(),p+=parseInt(s.count)/100,o[" "+n]?o[" "+n]+=parseInt(s.count)/100:o[" "+n]=parseInt(s.count)/100,c[" "+n]||(c[" "+n]={}),c[" "+n][s.payment_method]=parseInt(s.count)/100}),$.each(r,function(s,t){var n=t;e.push(n),g[s]=o[" "+t]||0,l[s]=c[" "+t]||{"Bank Transfer":0,Cash:0,Count:0}});var i={labels:e,datasets:[{label:"Doanh thu",data:g,customData:l,backgroundColor:["#6366F1"],borderColor:["#6366F1"],borderWidth:1}]};y.data=i,y.update()}),$.get("/current-month/chart-data",function(a){new Chart(k,{type:"doughnut",data:{labels:["Ca sáng","Ca chiều","Ca tối"],datasets:[{data:[a.morning,a.afternoon,a.night],backgroundColor:["#F59E0B","#0284C7","#EF4444"],hoverBackgroundColor:["#F59E0B","#0284C7","#EF4444"]}]},plugins:[F]});var r={labels:["Ca sáng","Ca chiều","Ca tối"],datasets:[{data:[a.morningMonth,a.afternoonMonth,a.nightMonth],backgroundColor:["#F59E0B","#0284C7","#EF4444"],hoverBackgroundColor:["#F59E0B","#0284C7","#EF4444"]}]};b.data=r,b.update()}),$(function(){$("#revenue").change(function(){var a=$(this).val();a&&($.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.post("/sales-purchases/chart-data",{picker_value:a}).done(function(r){var d=[];if(a=="Monthly"){var u=1,o=new Date().getMonth();for(new Date().getFullYear(),e=u;e<=o+1;e++)d.push(e)}else if(a=="Yearly"){var u=2024,o=new Date().getFullYear();for(e=u;e<=o;e++)d.push(e)}else{var o=new Date().getDate();new Date().getMonth();for(var e=1;e<=o;e++)d.push(e)}var c=[],g=[],l=[],p=[],i=[];$.each(d,function(t,n){c[" "+n]=0,l[" "+n]={"Bank Transfer":0,Cash:0}}),r.sales.original.statistics_data.forEach(function(t,n){if(t.statistic_day!==0){var h=t.statistic_day;a!="Monthly"&&a!="Yearly"&&(h=new Date(t.statistic_day).getDate()),l[" "+h]||(l[" "+h]={}),l[" "+h].Count=parseInt(t.count)}}),r.sales.original.data.forEach(function(t,n){var h=t.date;a!="Monthly"&&a!="Yearly"&&(h=new Date(t.date).getDate()),c[" "+h]?c[" "+h]+=parseInt(t.count)/100:c[" "+h]=parseInt(t.count)/100,l[" "+h]||(l[" "+h]={}),l[" "+h][t.payment_method]=parseInt(t.count)/100}),$.each(d,function(t,n){var h=a=="Monthly"?"Tháng "+n:n;g.push(h),p[t]=c[" "+n]||0,i[t]=l[" "+n]||{"Bank Transfer":0,Cash:0}});var s={labels:g,datasets:[{label:"Doanh thu",data:p,customData:i,backgroundColor:["#6366F1"],borderColor:["#6366F1"],borderWidth:1}]};y.data=s,y.update()}))}),$("#monthInput").change(function(){var a=$("#monthInput").val();if(!a)return;const r=a.split("-"),d=parseInt(r[0],10),u=parseInt(r[1],10);$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.post("/sales-purchases/chart-data",{picker_value:"Daily_Month",month:u,year:d}).done(function(o){for(var e=[],c=new Date(d,u,0).getDate(),g=1;g<=c;g++)e.push(g);var l=[],p=[],i=[],s=[],t=[];$.each(e,function(f,C){l[" "+C]=0,i[" "+C]={"Bank Transfer":0,Cash:0,Count:0}}),o.sales.original.statistics_data.forEach(function(f,C){if(f.statistic_day!==0){var v=new Date(f.statistic_day).getDate();i[" "+v]||(i[" "+v]={}),i[" "+v].Count=parseInt(f.count)}});var n=0;o.sales.original.data.forEach(function(f,C){var v=f.date;v=new Date(f.date).getDate(),n+=parseInt(f.count)/100,l[" "+v]?l[" "+v]+=parseInt(f.count)/100:l[" "+v]=parseInt(f.count)/100,i[" "+v]||(i[" "+v]={}),i[" "+v][f.payment_method]=parseInt(f.count)/100}),$.each(e,function(f,C){var v=C;p.push(v),s[f]=l[" "+C]||0,t[f]=i[" "+C]||{"Bank Transfer":0,Cash:0,Count:0}});var h={labels:p,datasets:[{label:"Doanh thu tổng trong tháng "+u+"-"+d+" là: "+D(n),data:s,customData:t,backgroundColor:["#6366F1"],borderColor:["#6366F1"],borderWidth:1}]};y.data=h,y.update()})}),$("#monthInputDoughnut").change(function(){var a=$("#monthInputDoughnut").val();if(!a)return;const r=a.split("-"),d=parseInt(r[0],10),u=parseInt(r[1],10);$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.post("/current-month/chart-data",{month:u,year:d}).done(function(o){var e={labels:["Ca sáng","Ca chiều","Ca tối"],datasets:[{data:[o.morningMonth,o.afternoonMonth,o.nightMonth],backgroundColor:["#F59E0B","#0284C7","#EF4444"],hoverBackgroundColor:["#F59E0B","#0284C7","#EF4444"]}]};b.data=e,b.update()})})})});
